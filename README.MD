***

# PostgreSQL 1C üêò

[![Docker Pulls](https://img.shields.io/docker/pulls/whitemanprk/postgres-1c)](https://hub.docker.com/r/whitemanprk/postgres-1c)
[![Docker Image Size](https://img.shields.io/docker/image-size/whitemanprk/postgres-1c/latest)](https://hub.docker.com/r/whitemanprk/postgres-1c)
[![PostgreSQL Version](https://img.shields.io/badge/PostgreSQL-17.5--11.1C-blue)](https://www.postgresql.org/)


**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–π Docker-–æ–±—Ä–∞–∑ PostgreSQL –¥–ª—è 1–°:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ —Å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π —Å–±–æ—Ä–∫–∏ –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö deb‚Äë–ø–∞–∫–µ—Ç–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –¥–µ–ø–ª–æ—è.**


***

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ **–°–±–æ—Ä–∫–∞ –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö deb-–ø–∞–∫–µ—Ç–æ–≤ PostgreSQL –¥–ª—è 1–°**
- ‚úÖ **–ú—É–ª—å—Ç–∏–≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å** ‚Äî –°–±–æ—Ä–∫–∞ –ø–æ–¥ –ª—é–±—É—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—É—é 1–° –≤–µ—Ä—Å–∏—é PostgreSQL (`PG_MAJOR`)
- ‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º postgres –∏ 1–°** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: `POSTGRES_USER`, `POSTGRES_DB`, ...; init‚Äë—Å–∫—Ä–∏–ø—Ç—ã, healthcheck, —Å–∏–≥–Ω–∞–ª—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è, –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–∫–ª–∞–¥–Ω—ã—Ö —Ä–æ–ª–µ–π (`DB_USER`, `DB_PASS`) –∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö (`DB_NAME`) —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ initdb‚Äë—Å–∫—Ä–∏–ø—Ç—ã** ‚Äî –ª—é–±—ã–µ *.sh/*.sql/*.sql.gz –≤ `/initdb` –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å—Ç–∞—Ä—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä–∞
- ‚úÖ **–ì–∏–±–∫–∞—è —Å–µ—Ç–µ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `PG_ALLOWED_HOSTS`, `PG_HBA_METHOD`, `PG_LISTEN_ADDRESSES` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —á–µ—Ä–µ–∑ —Å–≤–æ–π initdb-—Å–∫—Ä–∏–ø—Ç (–ø—Ä–∏–º–µ—Ä –Ω–∏–∂–µ)
- ‚úÖ **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** ‚Äî ru_RU.UTF-8 –¥–ª—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –∫–ª–∞—Å—Ç–µ—Ä–∞
- ‚úÖ **Healthcheck –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É Docker**

***

## üì¶ –ü–æ–ª—É—á–µ–Ω–∏–µ deb‚Äë–∞—Ä—Ö–∏–≤–æ–≤

–°–∫–∞—á–∞–π—Ç–µ —Å –ø–æ—Ä—Ç–∞–ª–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ 1–° –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ deb‚Äë–∞—Ä—Ö–∏–≤—ã:

- **–î–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤ –°–£–ë–î PostgreSQL –¥–ª—è Linux x86 (64-bit)**
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ postgres –¥–ª—è Debian 12 x86_64**

–†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ deb‚Äë—Ñ–∞–π–ª—ã –ø–æ –∫–∞—Ç–∞–ª–æ–≥–∞–º:

- `distr/<–≤–µ—Ä—Å–∏—è>/core/` ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞–∫–µ—Ç—ã (postgresql‚Äë16, postgresql‚Äëclient‚Äë16, libpq5 –∏ –¥—Ä.)
- `distr/<–≤–µ—Ä—Å–∏—è>/libs/` ‚Äî –≤—Å–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

***

## üõ†Ô∏è –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞

```bash
docker build -t postgres-1c:16 --build-arg PG_MAJOR=16 .
```


***

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —á–µ—Ä–µ–∑ Compose

```yaml
services:
  pg1c:
    image: whitemanprk/postgres-1c:16
    container_name: pg1c
    restart: unless-stopped
    stop_grace_period: 60s
    ports:
      - "${PG_PORT:-5432}:5432"
    environment:
      #POSTGRES_USER: "${POSTGRES_USER:-postgres}"
      POSTGRES_PASSWORD: "${POSTGRES_PASSWORD:-secret}"
      #POSTGRES_DB: "${POSTGRES_DB:-postgres}"
      #LANG: "${LANG:-ru_RU.UTF-8}"
      #LC_ALL: "${LC_ALL:-ru_RU.UTF-8}"
      #TZ: "${TZ:-Asia/Tomsk}"
      POSTGRES_INITDB_ARGS: "${POSTGRES_INITDB_ARGS:---encoding=UTF8 --locale=ru_RU.UTF-8}"
      #DB_USER: "${DB_USER:-app}"
      #DB_PASS: "${DB_PASS:-appPass123}"
      #DB_NAME: "${DB_NAME:-appdb}"
    volumes:
      - pg1c-data:/var/lib/postgresql/data
      #- ./pg1c-data:/var/lib/postgresql/data
      - ./initdb:/docker-entrypoint-initdb.d:ro

volumes:
 pg1c-data:
   driver: local
```

> –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ `.env.example` –∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞–ø–∫—É –¥–∞–Ω–Ω—ã—Ö –∏ initdb-—Å–∫—Ä–∏–ø—Ç–æ–≤.

***

## üìë –ü—Ä–∏–º–µ—Ä .env

```env
PG_PORT=5432

POSTGRES_PASSWORD=postgrespass

DB_USER=user1
DB_PASS=pass1
DB_NAME=test1,test2,test3

POSTGRES_INITDB_ARGS=--encoding=UTF8 --locale=ru_RU.UTF-8
TZ=Asia/Tomsk
```


***

## üåê –ü—Ä–∏–º–µ—Ä —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –≥–∏–±–∫–æ–π —Å–µ—Ç–µ–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä **–Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç** –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∏–ø–∞ `PG_ALLOWED_HOSTS`, `PG_HBA_METHOD`, `PG_LISTEN_ADDRESSES` —Å–∞–º –ø–æ —Å–µ–±–µ!
–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ pg_hba.conf –∏ listen_addresses –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –≤ `initdb/`, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```bash
#!/bin/bash
PG_HBA="${PGDATA}/pg_hba.conf"
PG_CONF="${PGDATA}/postgresql.conf"

if [[ -n "${PG_LISTEN_ADDRESSES}" ]]; then
  sed -i "s/^#listen_addresses =.*/listen_addresses = '${PG_LISTEN_ADDRESSES}'/" "$PG_CONF"
fi

if [[ -n "${PG_ALLOWED_HOSTS}" ]] && [[ -n "${PG_HBA_METHOD}" ]]; then
  IFS=',' read -ra HOSTS <<< "${PG_ALLOWED_HOSTS}"
  for HOST in "${HOSTS[@]}"; do
    echo "host    all    all    ${HOST}    ${PG_HBA_METHOD}" >> "$PG_HBA"
  done
fi
```


***

## üèóÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ initdb‚Äë—Å–∫—Ä–∏–ø—Ç—ã

–§–∞–π–ª—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ `initdb/` (sh, sql, –∞—Ä—Ö–∏–≤—ã) ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞.

***

## üìã –°–±–æ—Ä–∫–∞

- Debian 12 Bookworm (base image)
- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ deb‚Äë–ø–∞–∫–µ—Ç—ã PostgreSQL –¥–ª—è 1–° ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫–∞—á–∏–≤–∞–µ—Ç –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–∞–º

***

***

## ‚ÑπÔ∏è –í–∞–∂–Ω–æ: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

–≠—Ç–æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–µ–∞–ª–∏–∑—É–µ—Ç **—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫ PostgreSQL** —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ 1–°. –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –°–£–ë–î **—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** –ø–æ–¥ –≤–∞—à–∏ –∑–∞–¥–∞—á–∏ –∏ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã ‚Äî –∫–∞–∫ –∏ –¥–ª—è –ª—é–±–æ–≥–æ –ø—Ä–æ–¥–∞–∫—à–Ω-–¥–µ–ø–ª–æ—è PostgreSQL.

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–ª–∞—Å—Ç–µ—Ä–∞ –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ —Ç–∏–ø–æ–≤—ã–µ –∑–∞–¥–∞—á–∏.
- –ù–µ –∑–∞–±—É–¥—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ—Å—Ç—É–ø—ã:
    - –ê–¥—Ä–µ—Å–∞, —Å –∫–æ—Ç–æ—Ä—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (`pg_hba.conf` ‚Äî –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `PG_ALLOWED_HOSTS`, `PG_HBA_METHOD` —á–µ—Ä–µ–∑ initdb-—Å–∫—Ä–∏–ø—Ç).
    - –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è —Å–ª—É—à–∞—é—â–∏—Ö –∞–¥—Ä–µ—Å–æ–≤ (`listen_addresses` —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `PG_LISTEN_ADDRESSES` –∏–ª–∏ —è–≤–Ω–æ).
- –î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ –≤–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ —Ö–æ—Å—Ç–∞–º–∏/–ø–æ–¥—Å–µ—Ç—è–º–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

> –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–µ–∂–∏—Ç –Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–µ/–¥–µ–≤–æ–ø—Å–µ. –¢–æ—á–Ω–æ —Å–ª–µ–¥—É–π—Ç–µ –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ 1–°/–°–£–ë–î –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤–∞—à–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

***

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

**–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç** deb‚Äë–∞—Ä—Ö–∏–≤—ã PostgreSQL 1–°. –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ª–∏—Ü–µ–Ω–∑–∏—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ 1–°.

***
